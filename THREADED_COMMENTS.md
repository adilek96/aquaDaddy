# Threaded Comments - –î—Ä–µ–≤–æ–≤–∏–¥–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

## ‚ú® –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –¥—Ä–µ–≤–æ–≤–∏–¥–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π (threading).

## üéØ –§—É–Ω–∫—Ü–∏–∏

### 1. –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- –ú–æ–∂–Ω–æ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –ª—é–±–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- –û—Ç–≤–µ—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–¥ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è (–æ—Ç—Å—Ç—É–ø—ã)

### 2. –î—Ä–µ–≤–æ–≤–∏–¥–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- –î–æ 3 —É—Ä–æ–≤–Ω–µ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)
- –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤
- –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ/—Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤–µ—Ç–æ–∫

### 3. UX —É–ª—É—á—à–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫–∞ "–û—Ç–≤–µ—Ç–∏—Ç—å" –ø–æ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
- Inline —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞
- –°—á–µ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤
- –ö–Ω–æ–ø–∫–∏ "–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã"

## üì¶ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

**components/component/commentThread.tsx** - –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —Å –æ—Ç–≤–µ—Ç–∞–º–∏:
- –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- Inline —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞
- –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤–µ—Ç–æ–∫
- –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è

## üóÑÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ë–î

### –û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å Comment:

```prisma
model Comment {
  id         String   @id @default(cuid())
  userId     String
  aquariumId String
  text       String   @db.Text
  parentId   String?  // <- –ù–û–í–û–ï: ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  user       User     @relation(...)
  aquarium   Aquarium @relation(...)
  parent     Comment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies    Comment[] @relation("CommentReplies") // <- –ù–û–í–û–ï: –º–∞—Å—Å–∏–≤ –æ—Ç–≤–µ—Ç–æ–≤
  
  @@index([aquariumId])
  @@index([userId])
  @@index([parentId]) // <- –ù–û–í–û–ï: –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
}
```

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `parentId` - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (null –¥–ª—è –∫–æ—Ä–Ω–µ–≤—ã—Ö)
- `parent` - —Å–≤—è–∑—å —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
- `replies` - –º–∞—Å—Å–∏–≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ - –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –æ—Ç–≤–µ—Ç—ã

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```typescript
Comment {
  id: "comment-1",
  text: "–û—Ç–ª–∏—á–Ω—ã–π –∞–∫–≤–∞—Ä–∏—É–º!",
  parentId: null, // –ö–æ—Ä–Ω–µ–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
  replies: [
    {
      id: "comment-2",
      text: "–°–æ–≥–ª–∞—Å–µ–Ω!",
      parentId: "comment-1", // –û—Ç–≤–µ—Ç –Ω–∞ comment-1
      replies: [
        {
          id: "comment-3",
          text: "–ò —è —Ç–æ–∂–µ!",
          parentId: "comment-2", // –û—Ç–≤–µ—Ç –Ω–∞ comment-2
          replies: []
        }
      ]
    }
  ]
}
```

### –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:

```
‚îå‚îÄ –û—Ç–ª–∏—á–Ω—ã–π –∞–∫–≤–∞—Ä–∏—É–º!
‚îÇ  [–û—Ç–≤–µ—Ç–∏—Ç—å] [–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã (1)]
‚îÇ
‚îî‚îÄ‚î¨‚îÄ –°–æ–≥–ª–∞—Å–µ–Ω!
  ‚îÇ  [–û—Ç–≤–µ—Ç–∏—Ç—å] [–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã (1)]
  ‚îÇ
  ‚îî‚îÄ‚î¨‚îÄ –ò —è —Ç–æ–∂–µ!
    ‚îÇ  [–û—Ç–≤–µ—Ç–∏—Ç—å]
```

### –£—Ä–æ–≤–Ω–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:

```typescript
Level 0: –ö–æ—Ä–Ω–µ–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–±–µ–∑ –æ—Ç—Å—Ç—É–ø–∞)
Level 1: –û—Ç–≤–µ—Ç –Ω–∞ –∫–æ—Ä–Ω–µ–≤–æ–π (–æ—Ç—Å—Ç—É–ø 32px)
Level 2: –û—Ç–≤–µ—Ç –Ω–∞ –æ—Ç–≤–µ—Ç (–æ—Ç—Å—Ç—É–ø 64px)
Level 3: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–æ—Ç—Å—Ç—É–ø 96px)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –ò–∑–º–µ–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:

–í `app/discovery/[id]/page.tsx`:

```typescript
<CommentThread
  comment={comment}
  maxLevel={3} // <- –∏–∑–º–µ–Ω–∏—Ç—å –∑–¥–µ—Å—å (1-5 —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
  ...
/>
```

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
- `1` - —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤)
- `2` - –æ–¥–∏–Ω —É—Ä–æ–≤–µ–Ω—å –æ—Ç–≤–µ—Ç–æ–≤
- `3` - –¥–≤–∞ —É—Ä–æ–≤–Ω—è –æ—Ç–≤–µ—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `4-5` - –≥–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—É–¥–æ–±–Ω–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö)

### –ò–∑–º–µ–Ω–∏—Ç—å –æ—Ç—Å—Ç—É–ø –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤:

–í `components/component/commentThread.tsx`:

```typescript
<div className={`${level > 0 ? "ml-8 mt-4" : ""}`}>
  // ml-8 = 32px –æ—Ç—Å—Ç—É–ø
  // –ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ ml-4 (16px) –∏–ª–∏ ml-12 (48px)
</div>
```

## üé® UI/UX –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ö–Ω–æ–ø–∫–∞ "–û—Ç–≤–µ—Ç–∏—Ç—å":
- –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç inline —Ñ–æ—Ä–º—É
- –°–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ

### –§–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞:
- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è (2 —Å—Ç—Ä–æ–∫–∏)
- –°—á–µ—Ç—á–∏–∫ —Å–∏–º–≤–æ–ª–æ–≤ (1000 max)
- –ö–Ω–æ–ø–∫–∏ "–û—Ç–º–µ–Ω–∞" –∏ "–û—Ç–≤–µ—Ç–∏—Ç—å"
- –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ textarea

### –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤–µ—Ç–æ–∫:
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã (N)"
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
- –ò–∫–æ–Ω–∫–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑

### –í–∏–∑—É–∞–ª—å–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è:
- –û—Ç—Å—Ç—É–ø—ã —Å–ª–µ–≤–∞ (ml-8 –Ω–∞ –∫–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å)
- –†–∞–∑–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ —Ñ–æ–Ω–∞ (hover —ç—Ñ—Ñ–µ–∫—Ç)
- –õ–∏–Ω–∏–∏ —Å–≤—è–∑–∏ (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞ (1-1000 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç XSS (React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ –æ—Ç–≤–µ—Ç—ã
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ `onDelete: Cascade` –≤ Prisma
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω–µ–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (nested include)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ parentId –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥)
- ‚úÖ Lazy loading (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –≥–ª—É–±–æ–∫–∏—Ö –≤–µ—Ç–æ–∫)

### –ó–∞–ø—Ä–æ—Å—ã –∫ –ë–î:

**–ë—ã–ª–æ (–±–µ–∑ threading):**
```sql
SELECT * FROM Comment WHERE aquariumId = ?
```

**–°—Ç–∞–ª–æ (—Å threading):**
```sql
SELECT * FROM Comment 
WHERE aquariumId = ? AND parentId IS NULL
INCLUDE replies (
  INCLUDE replies (
    INCLUDE replies
  )
)
```

–û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å—é –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É!

## üöÄ –ó–∞–ø—É—Å–∫

### –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:
```bash
npx prisma db push  # ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞
npx prisma generate # ‚úÖ Prisma Client –æ–±–Ω–æ–≤–ª–µ–Ω
```

### –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
npm run dev
```

## üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –û—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
2. –ù–∞–∂–∏–º–∞–µ—Ç "–û—Ç–≤–µ—Ç–∏—Ç—å"
3. –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ä–º–∞ –ø–æ–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º
4. –ü–∏—à–µ—Ç –æ—Ç–≤–µ—Ç –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–≤–µ—Ç–∏—Ç—å"
5. –û—Ç–≤–µ—Ç –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å –æ—Ç—Å—Ç—É–ø–æ–º –ø–æ–¥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º

### –°–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤–µ—Ç–æ–∫:
1. –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–º–µ–µ—Ç –æ—Ç–≤–µ—Ç—ã
2. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è "–°–∫—Ä—ã—Ç—å –æ—Ç–≤–µ—Ç—ã (3)"
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç
4. –û—Ç–≤–µ—Ç—ã —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è
5. –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç–≤–µ—Ç—ã (3)"

### –£–¥–∞–ª–µ–Ω–∏–µ —Å –æ—Ç–≤–µ—Ç–∞–º–∏:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª—è–µ—Ç —Å–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
2. –ü–æ—è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
3. –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —É–¥–∞–ª—è–µ—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏ –≤—Å–µ –æ—Ç–≤–µ—Ç—ã
4. UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞ "Parent comment not found"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—ã—Ç–∞–µ—Ç–µ—Å—å –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ –±—ã–ª —É–¥–∞–ª–µ–Ω

### –û—Ç–≤–µ—Ç—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `replies` –≤–∫–ª—é—á–µ–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Prisma Client –æ–±–Ω–æ–≤–ª–µ–Ω
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏

### –°–ª–∏—à–∫–æ–º –≥–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —É—Ö–æ–¥—è—Ç –∑–∞ –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ `maxLevel` –¥–æ 2-3
- –£–º–µ–Ω—å—à–∏—Ç–µ –æ—Ç—Å—Ç—É–ø —Å `ml-8` –¥–æ `ml-4`
- –î–æ–±–∞–≤—å—Ç–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª

## üìà –ú–µ—Ç—Ä–∏–∫–∏

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:

```typescript
// –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (–≤–∫–ª—é—á–∞—è –æ—Ç–≤–µ—Ç—ã)
const totalComments = await prisma.comment.count({
  where: { aquariumId }
});

// –¢–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
const rootComments = await prisma.comment.count({
  where: { aquariumId, parentId: null }
});

// –°—Ä–µ–¥–Ω—è—è –≥–ª—É–±–∏–Ω–∞ –≤–µ—Ç–æ–∫
const avgDepth = totalComments / rootComments;
```

## üéØ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
1. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤** - "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ 5 –æ—Ç–≤–µ—Ç–æ–≤"
2. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤** - –ø–æ –¥–∞—Ç–µ, –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
3. **–£–ø–æ–º–∏–Ω–∞–Ω–∏—è** - @username –≤ –æ—Ç–≤–µ—Ç–∞—Ö
4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –∫–æ–≥–¥–∞ –∫—Ç–æ-—Ç–æ –æ—Ç–≤–µ—Ç–∏–ª –Ω–∞ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
5. **–õ–∏–Ω–∏–∏ —Å–≤—è–∑–∏** - –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏ –º–µ–∂–¥—É —É—Ä–æ–≤–Ω—è–º–∏
6. **–¶–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - —Ü–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
7. **–†–µ–∞–∫—Ü–∏–∏** - –ª–∞–π–∫–∏ –Ω–∞ –æ—Ç–≤–µ—Ç—ã
8. **–ú–æ–¥–µ—Ä–∞—Ü–∏—è** - —Å–∫—Ä—ã–≤–∞—Ç—å –≤–µ—Ç–∫–∏ —Å –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏

### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ UI:
1. **Flat threading** - –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ —Å —É–∫–∞–∑–∞—Ç–µ–ª–µ–º
2. **Collapsible by default** - –æ—Ç–≤–µ—Ç—ã —Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
3. **Infinite nesting** - –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É—Ä–æ–≤–Ω–µ–π
4. **Reddit-style** - —Å –ª–∏–Ω–∏—è–º–∏ –∏ —Ü–≤–µ—Ç–æ–≤—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

## üìö –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

### –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```typescript
const reply = await prisma.comment.create({
  data: {
    userId: "user-id",
    aquariumId: "aquarium-id",
    parentId: "parent-comment-id",
    text: "–ú–æ–π –æ—Ç–≤–µ—Ç",
  },
});
```

### –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–≤–µ—Ç—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:

```typescript
const replies = await prisma.comment.findMany({
  where: { parentId: "comment-id" },
  include: { user: true },
});
```

### –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å –≥–ª—É–±–∏–Ω—É –≤–µ—Ç–∫–∏:

```typescript
function getDepth(comment: Comment): number {
  if (!comment.replies || comment.replies.length === 0) {
    return 0;
  }
  return 1 + Math.max(...comment.replies.map(getDepth));
}
```

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 7 –¥–µ–∫–∞–±—Ä—è 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
